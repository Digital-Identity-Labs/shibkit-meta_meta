<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta name="Content-Type" content="text/html; charset=utf-8" />
<title>Class: Shibkit::Rack::Simulator::Model::SPSession</title>
<link rel="stylesheet" href="../../../../css/style.css" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="../../../../css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  relpath = '../../../..';
  if (relpath != '') relpath += '/';
</script>
<script type="text/javascript" charset="utf-8" src="../../../../js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="../../../../js/app.js"></script>

  </head>
  <body>
    <script type="text/javascript" charset="utf-8">
      if (window.top.frames.main) document.body.className = 'frames';
    </script>
    
    <div id="header">
      <div id="menu">
  
    <a href="../../../../_index.html">Index (S)</a> &raquo; 
    <span class='title'><span class='object_link'><a href="../../../../Shibkit.html" title="Shibkit (module)">Shibkit</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../../../Rack.html" title="Shibkit::Rack (module)">Rack</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../../Simulator.html" title="Shibkit::Rack::Simulator (class)">Simulator</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../Model.html" title="Shibkit::Rack::Simulator::Model (module)">Model</a></span></span>
     &raquo; 
    <span class="title">SPSession</span>
  
  
  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  <a id="class_list_link" href="#">Class List</a>
  <a id="method_list_link" href="#">Method List</a>
  <a id ="file_list_link" href="#">File List</a>
</div>

      <div class="clear"></div>
    </div>
    
    <iframe id="search_frame"></iframe>
    
    <div id="content"><h1>Class: Shibkit::Rack::Simulator::Model::SPSession
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">Shibkit::Rack::Simulator::Model::SPSession</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
      <dt class="r2">Includes:</dt>
      <dd class="r2"><span class='object_link'><a href="../../../Configured.html" title="Shibkit::Configured (module)">Configured</a></span></dd>
      
    
  
  
  
    <dt class="r1 last">Defined in:</dt>
    <dd class="r1 last">lib/shibkit/rack/simulator/models/sp_session.rb</dd>
  
</dl>
<div class="clear"></div>



  
  
  
  

  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#access%21-instance_method" title="#access! (instance method)">- (Object) <strong>access!</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Access the SP with an already authentication session.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#application_id-instance_method" title="#application_id (instance method)">- (Object) <strong>application_id</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
The Shibboleth SP application label (defaults to default).
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#attribute_headers-instance_method" title="#attribute_headers (instance method)">- (Object) <strong>attribute_headers</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Returns hash of attribute headers as they would be injected.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#destination-instance_method" title="#destination (instance method)">- (Object) <strong>destination</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Where is the user trying to go to?.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#entity_id-instance_method" title="#entity_id (instance method)">- (Object) <strong>entity_id</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
The Shibboleth SP entity ID.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#expired%3F-instance_method" title="#expired? (instance method)">- (Boolean) <strong>expired?</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Has the session expired?.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#flush_headers%21-instance_method" title="#flush_headers! (instance method)">- (Object) <strong>flush_headers!</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Remove all injected headers.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#idp_assertion-instance_method" title="#idp_assertion (instance method)">- (Object) <strong>idp_assertion</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Details about the user passed by IDP.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">- (SPSession) <strong>initialize</strong>(env) </a>
    

    
  </span>
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
A new SPSession.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#inject_headers%21-instance_method" title="#inject_headers! (instance method)">- (Object) <strong>inject_headers!</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Copy headers for session and user attributes, etc into Rack session.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#logged_in%3F-instance_method" title="#logged_in? (instance method)">- (Boolean) <strong>logged_in?</strong>(user_id) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Is the specified user logged in at the SP?.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#login%21-instance_method" title="#login! (instance method)">- (Object) <strong>login!</strong>(idp_assertion) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Declare that the user has logged in to the SP.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#login_time-instance_method" title="#login_time (instance method)">- (Object) <strong>login_time</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
When did the user first login?.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#logout%21-instance_method" title="#logout! (instance method)">- (Object) <strong>logout!</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Clear session for user.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#logout_path-instance_method" title="#logout_path (instance method)">- (Object) <strong>logout_path</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Location of the fake SP&#8217;s logout page.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#previous_access_time-instance_method" title="#previous_access_time (instance method)">- (Object) <strong>previous_access_time</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Time of most recent page view before this request.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#process_attribute_data-instance_method" title="#process_attribute_data (instance method)">- (Object) <strong>process_attribute_data</strong>(user_details) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Munge the data in attributes to match Shib/SAML expectations.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#remember_destination-instance_method" title="#remember_destination (instance method)">- (Object) <strong>remember_destination</strong>(destination) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Remember destination.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#reset%21-instance_method" title="#reset! (instance method)">- (Object) <strong>reset!</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Wipe SP session contents clean.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#session_expires-instance_method" title="#session_expires (instance method)">- (Object) <strong>session_expires</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Time when session expires.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#session_headers-instance_method" title="#session_headers (instance method)">- (Object) <strong>session_headers</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Returns hash of session headers as they would be injected.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#session_id-instance_method" title="#session_id (instance method)">- (Object) <strong>session_id</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
SP session ID.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#session_idle-instance_method" title="#session_idle (instance method)">- (Object) <strong>session_idle</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
How long has this session been idle? (in minutes).
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#session_path-instance_method" title="#session_path (instance method)">- (Object) <strong>session_path</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Location of the fake SP&#8217;s session status page.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#sp_session-instance_method" title="#sp_session (instance method)">- (Object) <strong>sp_session</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Convenient accessor to this object&#8217;s session data.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#user_record_filter-instance_method" title="#user_record_filter (instance method)">- (Object) <strong>user_record_filter</strong>(munged_data) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
User-overridable method - monkey patch with shibsim_filter.rb.
</p>
</div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="../../../Configured.html" title="Shibkit::Configured (module)">Configured</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../../../Configured.html#config-instance_method" title="Shibkit::Configured#config (method)">#config</a></span></p>
<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <p class="signature first" id="initialize-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="Shibkit::Rack::Simulator::Model::SPSession (class)">SPSession</a></span></tt>) <strong>initialize</strong>(env) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
A new SPSession
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


14
15
16
17
18
19
20
21
22
23
24
25</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/shibkit/rack/simulator/models/sp_session.rb', line 14</span>

<span class='def def kw'>def</span> <span class='initialize identifier id'>initialize</span><span class='lparen token'>(</span><span class='env identifier id'>env</span><span class='rparen token'>)</span>
  
  <span class='comment val'>## Store reference to the Rack session: all object data will be stored</span>
  <span class='comment val'>## in here - this class is really just an interface to part of session</span>
  <span class='comment val'>## and aspects of configuration </span>
  <span class='@env ivar id'>@env</span> <span class='assign token'>=</span> <span class='env identifier id'>env</span>
  
  <span class='comment val'>## Make sure we have a data structure</span>
  <span class='@env ivar id'>@env</span><span class='lbrack token'>[</span><span class='string val'>'rack.session'</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='string val'>'shibkit-simulator'</span><span class='rbrack token'>]</span>       <span class='opasgn op'>||=</span> <span class='Hash constant id'>Hash</span><span class='dot token'>.</span><span class='new identifier id'>new</span>
  <span class='@env ivar id'>@env</span><span class='lbrack token'>[</span><span class='string val'>'rack.session'</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='string val'>'shibkit-simulator'</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='string val'>'sp'</span><span class='rbrack token'>]</span> <span class='opasgn op'>||=</span> <span class='Hash constant id'>Hash</span><span class='dot token'>.</span><span class='new identifier id'>new</span>
  
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
  
</div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="access!-instance_method">
  
    - (<tt>Object</tt>) <strong>access!</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Access the SP with an already authentication session
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


40
41
42
43
44</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/shibkit/rack/simulator/models/sp_session.rb', line 40</span>

<span class='def def kw'>def</span> <span class='access! fid id'>access!</span>
  
  <span class='sp_session identifier id'>sp_session</span><span class='lbrack token'>[</span><span class='symbol val'>:access_time</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='Time constant id'>Time</span><span class='dot token'>.</span><span class='new identifier id'>new</span>
  
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="application_id-instance_method">
  
    - (<tt>Object</tt>) <strong>application_id</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
The Shibboleth SP application label (defaults to default)
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


135
136
137
138
139</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/shibkit/rack/simulator/models/sp_session.rb', line 135</span>

<span class='def def kw'>def</span> <span class='application_id identifier id'>application_id</span>

  <span class='return return kw'>return</span> <span class='config identifier id'>config</span><span class='dot token'>.</span><span class='sim_application identifier id'>sim_application</span>

<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="attribute_headers-instance_method">
  
    - (<tt>Object</tt>) <strong>attribute_headers</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Returns hash of attribute headers as they would be injected
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/shibkit/rack/simulator/models/sp_session.rb', line 170</span>

<span class='def def kw'>def</span> <span class='attribute_headers identifier id'>attribute_headers</span>

  <span class='headers identifier id'>headers</span> <span class='assign token'>=</span> <span class='Hash constant id'>Hash</span><span class='dot token'>.</span><span class='new identifier id'>new</span>
  
  <span class='comment val'>#raise Rack::Simulator::RuntimeError, &quot;Missing user details when trying to add SP headers&quot; unless user_details</span>
  
  <span class='comment val'>## Convert to proper format that matches the live SP (also add new ones)</span>
  <span class='prepared_data identifier id'>prepared_data</span> <span class='assign token'>=</span> <span class='process_attribute_data identifier id'>process_attribute_data</span><span class='lparen token'>(</span><span class='idp_assertion identifier id'>idp_assertion</span><span class='dot token'>.</span><span class='something identifier id'>something</span><span class='rparen token'>)</span> <span class='comment val'># TODO</span>

  <span class='comment val'>## Now the useful bit</span>
  <span class='prepared_data identifier id'>prepared_data</span><span class='dot token'>.</span><span class='each_pair identifier id'>each_pair</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span> <span class='header identifier id'>header</span><span class='comma token'>,</span> <span class='value identifier id'>value</span><span class='bitor op'>|</span> 

    <span class='headers identifier id'>headers</span><span class='lbrack token'>[</span><span class='header identifier id'>header</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='value identifier id'>value</span>

  <span class='end end kw'>end</span>

  <span class='comment val'>## Inject the rather important eptid varieties</span>
  <span class='headers identifier id'>headers</span><span class='lbrack token'>[</span><span class='string val'>'targeted-id'</span><span class='rbrack token'>]</span>   <span class='assign token'>=</span> <span class='prepared_data identifier id'>prepared_data</span><span class='lbrack token'>[</span><span class='string val'>'targeted_id'</span><span class='rbrack token'>]</span>   <span class='orop op'>||</span> 
    <span class='Shibkit constant id'>Shibkit</span><span class='colon2 op'>::</span><span class='DataTools constant id'>DataTools</span><span class='dot token'>.</span><span class='targeted_id identifier id'>targeted_id</span><span class='lparen token'>(</span><span class='user_details identifier id'>user_details</span><span class='lbrack token'>[</span><span class='string val'>'id'</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='sp_id identifier id'>sp_id</span><span class='comma token'>,</span> <span class='user_details identifier id'>user_details</span><span class='lbrack token'>[</span><span class='string val'>'idp_scope'</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='user_details identifier id'>user_details</span><span class='lbrack token'>[</span><span class='string val'>'idp_salt'</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='type identifier id'>type</span><span class='assign token'>=</span><span class='symbol val'>:computed</span><span class='rparen token'>)</span>
  <span class='headers identifier id'>headers</span><span class='lbrack token'>[</span><span class='string val'>'persistent-id'</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='prepared_data identifier id'>prepared_data</span><span class='lbrack token'>[</span><span class='string val'>'persistent_id'</span><span class='rbrack token'>]</span> <span class='orop op'>||</span>
    <span class='Shibkit constant id'>Shibkit</span><span class='colon2 op'>::</span><span class='DataTools constant id'>DataTools</span><span class='dot token'>.</span><span class='persistent_id identifier id'>persistent_id</span><span class='lparen token'>(</span><span class='user_details identifier id'>user_details</span><span class='lbrack token'>[</span><span class='string val'>'id'</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='sp_id identifier id'>sp_id</span><span class='comma token'>,</span> <span class='user_details identifier id'>user_details</span><span class='lbrack token'>[</span><span class='string val'>'idp_id'</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='user_details identifier id'>user_details</span><span class='lbrack token'>[</span><span class='string val'>'idp_salt'</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='type identifier id'>type</span><span class='assign token'>=</span><span class='symbol val'>:computed</span><span class='rparen token'>)</span>
  
  <span class='comment val'>## Cache the persistent ID for this user # TODO ? </span>
  <span class='comment val'>#user_details['persistent_id'] = headers['persistent-id']</span>

  
  <span class='return return kw'>return</span> <span class='headers identifier id'>headers</span>

<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="destination-instance_method">
  
    - (<tt>Object</tt>) <strong>destination</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Where is the user trying to go to?
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


163
164
165
166
167</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/shibkit/rack/simulator/models/sp_session.rb', line 163</span>

<span class='def def kw'>def</span> <span class='destination identifier id'>destination</span>
  
  <span class='return return kw'>return</span> <span class='sp_session identifier id'>sp_session</span><span class='lbrack token'>[</span><span class='symbol val'>:destination</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='path identifier id'>path</span> <span class='orop op'>||</span> <span class='config identifier id'>config</span><span class='dot token'>.</span><span class='home_path identifier id'>home_path</span>
  
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="entity_id-instance_method">
  
    - (<tt>Object</tt>) <strong>entity_id</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
The Shibboleth SP entity ID
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


142
143
144
145
146</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/shibkit/rack/simulator/models/sp_session.rb', line 142</span>

<span class='def def kw'>def</span> <span class='entity_id identifier id'>entity_id</span>

  <span class='return return kw'>return</span> <span class='config identifier id'>config</span><span class='dot token'>.</span><span class='sim_sp_entity_id identifier id'>sim_sp_entity_id</span>

<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="expired?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>expired?</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Has the session expired?
</p>


  </div>
</div>
<div class="tags">
  <h3>Returns:</h3>
<ul class="return">
  
    <li>
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


79
80
81
82
83</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/shibkit/rack/simulator/models/sp_session.rb', line 79</span>

<span class='def def kw'>def</span> <span class='expired? fid id'>expired?</span>
  
  <span class='return return kw'>return</span> <span class='false false kw'>false</span> <span class='if if_mod kw'>if</span> <span class='Time constant id'>Time</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='lt op'>&lt;</span> <span class='session_expires identifier id'>session_expires</span>
  
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="flush_headers!-instance_method">
  
    - (<tt>Object</tt>) <strong>flush_headers!</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Remove all injected headers
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


262
263
264
265
266
267
268</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/shibkit/rack/simulator/models/sp_session.rb', line 262</span>

<span class='def def kw'>def</span> <span class='flush_headers! fid id'>flush_headers!</span>

  <span class='session_headers identifier id'>session_headers</span><span class='dot token'>.</span><span class='each_key identifier id'>each_key</span>   <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='header identifier id'>header</span><span class='bitor op'>|</span> <span class='@env ivar id'>@env</span><span class='lbrack token'>[</span><span class='header identifier id'>header</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span> <span class='rbrace token'>}</span>
  
  <span class='attribute_headers identifier id'>attribute_headers</span><span class='dot token'>.</span><span class='each_key identifier id'>each_key</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='header identifier id'>header</span><span class='bitor op'>|</span> <span class='@env ivar id'>@env</span><span class='lbrack token'>[</span><span class='header identifier id'>header</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span> <span class='rbrace token'>}</span>

<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="idp_assertion-instance_method">
  
    - (<tt>Object</tt>) <strong>idp_assertion</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Details about the user passed by IDP
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


149
150
151
152
153</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/shibkit/rack/simulator/models/sp_session.rb', line 149</span>

<span class='def def kw'>def</span> <span class='idp_assertion identifier id'>idp_assertion</span>
  
  <span class='return return kw'>return</span> <span class='sp_session identifier id'>sp_session</span><span class='lbrack token'>[</span><span class='symbol val'>:idp_assertion</span><span class='rbrack token'>]</span>
  
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="inject_headers!-instance_method">
  
    - (<tt>Object</tt>) <strong>inject_headers!</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Copy headers for session and user attributes, etc into Rack session
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


253
254
255
256
257
258
259</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/shibkit/rack/simulator/models/sp_session.rb', line 253</span>

<span class='def def kw'>def</span> <span class='inject_headers! fid id'>inject_headers!</span>
  
  <span class='session_headers identifier id'>session_headers</span><span class='dot token'>.</span><span class='each_pair identifier id'>each_pair</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='header identifier id'>header</span><span class='comma token'>,</span> <span class='value identifier id'>value</span><span class='bitor op'>|</span> <span class='@env ivar id'>@env</span><span class='lbrack token'>[</span><span class='header identifier id'>header</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='value identifier id'>value</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='rbrace token'>}</span>
  
  <span class='attribute_headers identifier id'>attribute_headers</span><span class='dot token'>.</span><span class='each_pair identifier id'>each_pair</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='header identifier id'>header</span><span class='comma token'>,</span> <span class='value identifier id'>value</span><span class='bitor op'>|</span> <span class='@env ivar id'>@env</span><span class='lbrack token'>[</span><span class='header identifier id'>header</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='value identifier id'>value</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='rbrace token'>}</span>
  
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="logged_in?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>logged_in?</strong>(user_id) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Is the specified user logged in at the SP?
</p>


  </div>
</div>
<div class="tags">
  <h3>Returns:</h3>
<ul class="return">
  
    <li>
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/shibkit/rack/simulator/models/sp_session.rb', line 61</span>

<span class='def def kw'>def</span> <span class='logged_in? fid id'>logged_in?</span><span class='lparen token'>(</span><span class='user_id identifier id'>user_id</span><span class='rparen token'>)</span>

  <span class='return return kw'>return</span> <span class='false false kw'>false</span> <span class='if if_mod kw'>if</span> <span class='expired? fid id'>expired?</span>
  
  <span class='comment val'>## Has the fake IDP 'authenticated'?</span>
  <span class='return return kw'>return</span> <span class='false false kw'>false</span> <span class='unless unless_mod kw'>unless</span> <span class='sp_session identifier id'>sp_session</span><span class='lbrack token'>[</span><span class='symbol val'>:user_id</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span> <span class='gt op'>&gt;</span> <span class='integer val'>0</span>

  <span class='comment val'>## Check that the *same* user has already authenticated with the fake SP too.</span>
  <span class='comment val'>#return true if env[&quot;rack.session&quot;]['shibkit-simulator']['idp'][:user_id].to_i == </span>
  <span class='comment val'>#  sim_sp_session(env)[:user_id].to_i</span>
  <span class='comment val'>#return false</span>
  
  
  <span class='return return kw'>return</span> <span class='sp_session identifier id'>sp_session</span><span class='lbrack token'>[</span><span class='symbol val'>:user_id</span><span class='rbrack token'>]</span> <span class='eq op'>==</span> <span class='user_id identifier id'>user_id</span>

<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="login!-instance_method">
  
    - (<tt>Object</tt>) <strong>login!</strong>(idp_assertion) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Declare that the user has logged in to the SP
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


28
29
30
31
32
33
34
35
36
37</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/shibkit/rack/simulator/models/sp_session.rb', line 28</span>

<span class='def def kw'>def</span> <span class='login! fid id'>login!</span><span class='lparen token'>(</span><span class='idp_assertion identifier id'>idp_assertion</span><span class='rparen token'>)</span>

  <span class='sp_session identifier id'>sp_session</span><span class='lbrack token'>[</span><span class='symbol val'>:user_id</span><span class='rbrack token'>]</span>     <span class='assign token'>=</span> <span class='idp_assertion identifier id'>idp_assertion</span><span class='dot token'>.</span><span class='sim_user_id identifier id'>sim_user_id</span>
  <span class='sp_session identifier id'>sp_session</span><span class='lbrack token'>[</span><span class='symbol val'>:login_time</span><span class='rbrack token'>]</span>  <span class='assign token'>=</span> <span class='Time constant id'>Time</span><span class='dot token'>.</span><span class='new identifier id'>new</span>
  <span class='sp_session identifier id'>sp_session</span><span class='lbrack token'>[</span><span class='symbol val'>:access_time</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='sp_session identifier id'>sp_session</span><span class='lbrack token'>[</span><span class='symbol val'>:login_time</span><span class='rbrack token'>]</span>
  
  <span class='comment val'>## Construct a new session ID </span>
  <span class='sp_session identifier id'>sp_session</span><span class='lbrack token'>[</span><span class='symbol val'>:session_id</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='Shibkit constant id'>Shibkit</span><span class='colon2 op'>::</span><span class='DataTools constant id'>DataTools</span><span class='dot token'>.</span><span class='xsid identifier id'>xsid</span>
  
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="login_time-instance_method">
  
    - (<tt>Object</tt>) <strong>login_time</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
When did the user first login?
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


100
101
102
103
104</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/shibkit/rack/simulator/models/sp_session.rb', line 100</span>

<span class='def def kw'>def</span> <span class='login_time identifier id'>login_time</span>
  
  <span class='return return kw'>return</span> <span class='sp_session identifier id'>sp_session</span><span class='lbrack token'>[</span><span class='symbol val'>:login_time</span><span class='rbrack token'>]</span>
  
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="logout!-instance_method">
  
    - (<tt>Object</tt>) <strong>logout!</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Clear session for user
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


47
48
49
50
51</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/shibkit/rack/simulator/models/sp_session.rb', line 47</span>

<span class='def def kw'>def</span> <span class='logout! fid id'>logout!</span>
  
  <span class='reset! fid id'>reset!</span>
  
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="logout_path-instance_method">
  
    - (<tt>Object</tt>) <strong>logout_path</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Location of the fake SP&#8217;s logout page
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


93
94
95
96
97</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/shibkit/rack/simulator/models/sp_session.rb', line 93</span>

<span class='def def kw'>def</span> <span class='logout_path identifier id'>logout_path</span>

  <span class='return return kw'>return</span> <span class='config identifier id'>config</span><span class='dot token'>.</span><span class='sim_sp_logout_path identifier id'>sim_sp_logout_path</span>

<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="previous_access_time-instance_method">
  
    - (<tt>Object</tt>) <strong>previous_access_time</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Time of most recent page view before this request
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


107
108
109
110
111</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/shibkit/rack/simulator/models/sp_session.rb', line 107</span>

<span class='def def kw'>def</span> <span class='previous_access_time identifier id'>previous_access_time</span>
  
  <span class='return return kw'>return</span> <span class='sp_session identifier id'>sp_session</span><span class='lbrack token'>[</span><span class='symbol val'>:access_time</span><span class='rbrack token'>]</span>
  
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="process_attribute_data-instance_method">
  
    - (<tt>Object</tt>) <strong>process_attribute_data</strong>(user_details) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Munge the data in attributes to match Shib/SAML expectations
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


280
281
282
283
284
285
286
287
288
289</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/shibkit/rack/simulator/models/sp_session.rb', line 280</span>

<span class='def def kw'>def</span> <span class='process_attribute_data identifier id'>process_attribute_data</span><span class='lparen token'>(</span><span class='user_details identifier id'>user_details</span><span class='rparen token'>)</span>

  <span class='munged_data identifier id'>munged_data</span> <span class='assign token'>=</span> <span class='user_details identifier id'>user_details</span><span class='dot token'>.</span><span class='dup identifier id'>dup</span>

  <span class='comment val'>## Call out to filter (this is monkey patched by shibsim_filter.rb)</span>
  <span class='munged_data identifier id'>munged_data</span> <span class='assign token'>=</span> <span class='user_record_filter identifier id'>user_record_filter</span><span class='lparen token'>(</span><span class='munged_data identifier id'>munged_data</span><span class='rparen token'>)</span>

  <span class='return return kw'>return</span> <span class='munged_data identifier id'>munged_data</span>

<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="remember_destination-instance_method">
  
    - (<tt>Object</tt>) <strong>remember_destination</strong>(destination) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Remember destination
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


156
157
158
159
160</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/shibkit/rack/simulator/models/sp_session.rb', line 156</span>

<span class='def def kw'>def</span> <span class='remember_destination identifier id'>remember_destination</span><span class='lparen token'>(</span><span class='destination identifier id'>destination</span><span class='rparen token'>)</span>
  
  <span class='sp_session identifier id'>sp_session</span><span class='lbrack token'>[</span><span class='symbol val'>:destination</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='destination identifier id'>destination</span>
  
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="reset!-instance_method">
  
    - (<tt>Object</tt>) <strong>reset!</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Wipe SP session contents clean
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


54
55
56
57
58</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/shibkit/rack/simulator/models/sp_session.rb', line 54</span>

<span class='def def kw'>def</span> <span class='reset! fid id'>reset!</span>
  
  <span class='sp_session identifier id'>sp_session</span><span class='dot token'>.</span><span class='replace identifier id'>replace</span><span class='lparen token'>(</span><span class='Hash constant id'>Hash</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='rparen token'>)</span>
  
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="session_expires-instance_method">
  
    - (<tt>Object</tt>) <strong>session_expires</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Time when session expires
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


121
122
123
124
125</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/shibkit/rack/simulator/models/sp_session.rb', line 121</span>

<span class='def def kw'>def</span> <span class='session_expires identifier id'>session_expires</span>

  <span class='return return kw'>return</span> <span class='Time constant id'>Time</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='minus op'>-</span> <span class='sp_session identifier id'>sp_session</span><span class='lbrack token'>[</span><span class='symbol val'>:login_time</span><span class='rbrack token'>]</span>

<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="session_headers-instance_method">
  
    - (<tt>Object</tt>) <strong>session_headers</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Returns hash of session headers as they would be injected
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/shibkit/rack/simulator/models/sp_session.rb', line 201</span>

<span class='def def kw'>def</span> <span class='session_headers identifier id'>session_headers</span>
  
  <span class='headers identifier id'>headers</span> <span class='assign token'>=</span> <span class='Hash constant id'>Hash</span><span class='dot token'>.</span><span class='new identifier id'>new</span>
  
  <span class='comment val'>## Application ID</span>
  <span class='headers identifier id'>headers</span><span class='lbrack token'>[</span><span class='string val'>'Shib-Application-ID'</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='string val'>'default'</span>

  <span class='comment val'>## Persistent Session ID</span>
  <span class='session_id identifier id'>session_id</span> <span class='assign token'>=</span> <span class='sp_session identifier id'>sp_session</span><span class='lparen token'>(</span><span class='env identifier id'>env</span><span class='rparen token'>)</span><span class='lbrack token'>[</span><span class='symbol val'>:session_id</span><span class='rbrack token'>]</span>
  <span class='headers identifier id'>headers</span><span class='lbrack token'>[</span><span class='string val'>'Shib-Session-ID'</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='session_id identifier id'>session_id</span>

  <span class='comment val'>## Identity Provider ID</span>
  <span class='headers identifier id'>headers</span><span class='lbrack token'>[</span><span class='string val'>'Shib-Identity-Provider'</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='entity_id identifier id'>entity_id</span>

  <span class='comment val'>## Time authentication occured as a string in xs:DateTime format (with no timezone for some reason)  # TODO</span>
  <span class='headers identifier id'>headers</span><span class='lbrack token'>[</span><span class='string val'>'Shib-Authentication-Instant'</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='login_time identifier id'>login_time</span><span class='dot token'>.</span><span class='xmlschema identifier id'>xmlschema</span><span class='dot token'>.</span><span class='gsub identifier id'>gsub</span><span class='lparen token'>(</span><span class='regexp val'>/(\+.*)/</span><span class='comma token'>,</span> <span class='string val'>'Z'</span><span class='rparen token'>)</span>

  <span class='comment val'>## Keep login method rather vague # TODO</span>
  <span class='headers identifier id'>headers</span><span class='lbrack token'>[</span><span class='string val'>'Shib-Authentication-Method'</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='string val'>'urn:oasis:names:tc:SAML:1.0:am:unspecified'</span>
  <span class='headers identifier id'>headers</span><span class='lbrack token'>[</span><span class='string val'>'Shib-AuthnContext-Class'</span><span class='rbrack token'>]</span>    <span class='assign token'>=</span> <span class='string val'>'urn:oasis:names:tc:SAML:1.0:am:unspecified'</span>

  <span class='comment val'>## Assertion headers are cargo-culted for not (not sensible - Do Not Use)</span>
  <span class='assertion_header_info identifier id'>assertion_header_info</span><span class='lparen token'>(</span><span class='session_id identifier id'>session_id</span><span class='comma token'>,</span> <span class='user_details identifier id'>user_details</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='each_pair identifier id'>each_pair</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='header identifier id'>header</span><span class='comma token'>,</span> <span class='value identifier id'>value</span><span class='bitor op'>|</span> <span class='env identifier id'>env</span><span class='lbrack token'>[</span><span class='header identifier id'>header</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='value identifier id'>value</span><span class='rbrace token'>}</span>
  <span class='headers identifier id'>headers</span><span class='lbrack token'>[</span><span class='string val'>'Shib-Assertion-Count'</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='string val'>&quot;%02d&quot;</span> <span class='mod op'>%</span> <span class='assertion_header_info identifier id'>assertion_header_info</span><span class='lparen token'>(</span><span class='session_id identifier id'>session_id</span><span class='comma token'>,</span> <span class='user_details identifier id'>user_details</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='size identifier id'>size</span>

  <span class='comment val'>## Is targeted ID set to be automatic?</span>
  <span class='headers identifier id'>headers</span><span class='lbrack token'>[</span><span class='string val'>'REMOTE_USER'</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='user_details identifier id'>user_details</span><span class='lbrack token'>[</span><span class='string val'>'persistent_id'</span><span class='rbrack token'>]</span> <span class='orop op'>||</span>
    <span class='Shibkit constant id'>Shibkit</span><span class='colon2 op'>::</span><span class='DataTools constant id'>DataTools</span><span class='dot token'>.</span><span class='persistent_id identifier id'>persistent_id</span><span class='lparen token'>(</span><span class='user_details identifier id'>user_details</span><span class='lbrack token'>[</span><span class='string val'>'id'</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
      <span class='sp_id identifier id'>sp_id</span><span class='comma token'>,</span> <span class='user_details identifier id'>user_details</span><span class='lbrack token'>[</span><span class='string val'>'idp_id'</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
      <span class='user_details identifier id'>user_details</span><span class='lbrack token'>[</span><span class='string val'>'idp_salt'</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
      <span class='type identifier id'>type</span><span class='assign token'>=</span><span class='symbol val'>:computed</span><span class='rparen token'>)</span>
  
  <span class='comment val'>## This is pure cargo-cult nonsense but enhances the fakery (at some point real assertion parts should be faked, maybe?)</span>
  <span class='comment val'>## This should be based on total size of assertion data I believe (this is Shib1.3 style?)</span>
  <span class='lparen token'>(</span><span class='float val'>1</span><span class='dot2 op'>..</span><span class='integer val'>2</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='assertion_part identifier id'>assertion_part</span><span class='bitor op'>|</span>

    <span class='comment val'>## Each assertion fragment gets a numbered identifier</span>
    <span class='header identifier id'>header</span> <span class='assign token'>=</span> <span class='string val'>'Shib-Assertion-'</span> <span class='plus op'>+</span> <span class='string val'>&quot;%02d&quot;</span> <span class='mod op'>%</span> <span class='assertion_part identifier id'>assertion_part</span>

    <span class='comment val'>## Building up a mock URL</span>
    <span class='value identifier id'>value</span>  <span class='assign token'>=</span> <span class='config identifier id'>config</span><span class='dot token'>.</span><span class='sim_assertion_base identifier id'>sim_assertion_base</span> <span class='plus op'>+</span> <span class='string val'>'?key='</span> <span class='plus op'>+</span> <span class='session_id identifier id'>session_id</span> <span class='plus op'>+</span> <span class='string val'>'&amp;ID='</span> <span class='plus op'>+</span> <span class='Shibkit constant id'>Shibkit</span><span class='colon2 op'>::</span><span class='DataTools constant id'>DataTools</span><span class='dot token'>.</span><span class='xsid identifier id'>xsid</span>

    <span class='comment val'>## Collect it</span>
    <span class='headers identifier id'>headers</span><span class='lbrack token'>[</span><span class='header identifier id'>header</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='value identifier id'>value</span>

  <span class='end end kw'>end</span>
  
  <span class='return return kw'>return</span> <span class='headers identifier id'>headers</span>
  
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="session_id-instance_method">
  
    - (<tt>Object</tt>) <strong>session_id</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
SP session ID
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


114
115
116
117
118</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/shibkit/rack/simulator/models/sp_session.rb', line 114</span>

<span class='def def kw'>def</span> <span class='session_id identifier id'>session_id</span>
  
  <span class='return return kw'>return</span> <span class='sp_session identifier id'>sp_session</span><span class='lbrack token'>[</span><span class='symbol val'>:session_id</span><span class='rbrack token'>]</span>
  
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="session_idle-instance_method">
  
    - (<tt>Object</tt>) <strong>session_idle</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
How long has this session been idle? (in minutes)
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


128
129
130
131
132</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/shibkit/rack/simulator/models/sp_session.rb', line 128</span>

<span class='def def kw'>def</span> <span class='session_idle identifier id'>session_idle</span>

  <span class='return return kw'>return</span> <span class='Time constant id'>Time</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='minus op'>-</span> <span class='Time constant id'>Time</span><span class='dot token'>.</span><span class='login identifier id'>login</span>

<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="session_path-instance_method">
  
    - (<tt>Object</tt>) <strong>session_path</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Location of the fake SP&#8217;s session status page
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


86
87
88
89
90</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/shibkit/rack/simulator/models/sp_session.rb', line 86</span>

<span class='def def kw'>def</span> <span class='session_path identifier id'>session_path</span>

  <span class='return return kw'>return</span> <span class='config identifier id'>config</span><span class='dot token'>.</span><span class='sim_sp_session_path identifier id'>sim_sp_session_path</span>

<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="sp_session-instance_method">
  
    - (<tt>Object</tt>) <strong>sp_session</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Convenient accessor to this object&#8217;s session data
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


273
274
275
276
277</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/shibkit/rack/simulator/models/sp_session.rb', line 273</span>

<span class='def def kw'>def</span> <span class='sp_session identifier id'>sp_session</span>
  
  <span class='return return kw'>return</span> <span class='@env ivar id'>@env</span><span class='lbrack token'>[</span><span class='string val'>'rack.session'</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='string val'>'shibkit-simulator'</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='string val'>'sp'</span><span class='rbrack token'>]</span> 
  
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="user_record_filter-instance_method">
  
    - (<tt>Object</tt>) <strong>user_record_filter</strong>(munged_data) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
User-overridable method - monkey patch with shibsim_filter.rb
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


292
293
294
295
296</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/shibkit/rack/simulator/models/sp_session.rb', line 292</span>

<span class='def def kw'>def</span> <span class='user_record_filter identifier id'>user_record_filter</span><span class='lparen token'>(</span><span class='munged_data identifier id'>munged_data</span><span class='rparen token'>)</span>

  <span class='return return kw'>return</span> <span class='munged_data identifier id'>munged_data</span>

<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>
    
    <div id="footer">
  Generated on Sun Oct 31 22:31:54 2010 by 
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.6.1 (ruby-1.8.7).
</div>

  </body>
</html>